<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
     <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> 
     <style>
     .scale {
    width: 100px;
     }
     </style>
  </head>
  <body>
  <div class= "container">
    <div class="container text-center">
   
      <h1> Spotify Search </h1>
      <form>
    <input type="text" name="query" placeholder="Search for...">
    <button id="submit">Submit</button>

    
  </form>
  </div>
  <div class="results-list">
  <ul class="media-list list-group">
  </ul>
  </div>

 <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body">
          <ul class="list-group"></ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>

  </div>
 

    <script type="text/javascript">
    (function() {
  
      $('#submit').on('click',searchSpotify);

      function searchSpotify(event) {
        event.preventDefault();
        var query = $("input[name=query]").val();
        console.debug('SUBMITTED');
        var search_string = query.replace(' ','%20');
        console.log(search_string)
        $.ajax({
          url: 'https://api.spotify.com/v1/search?type=artist&query='+search_string,
          data: '',
          success: handleResults,
          error: handleError,
          dataType: 'json'
          });

         function handleResults (results) {
          var artists = results.artists.items;
          var image_string;
          $(".results-list ul").empty();
          artists.forEach(function (artist){

            if (artist.images.length>0)
              {image_string = '<div class="media-left"><img class="media-object scale" src ='+artist.images[0].url +'></div>'}
            else{
              image_string = ""
            }
          var artist_string = '<a class="show-album-list" data-toggle="modal" data-target="#myModal">'+artist.name+ '</a>'    
          var html_string ='<li class="media list-group-item"> '+image_string+ '<div class="media-body"><h3 class="media-heading">' +artist_string+ '</h3> </div> </li>'
         
          $('.results-list ul').append(html_string)

        })
         }

        
      }
  function handleError (err1, err2, err3) {
          console.error('OH NO!!', err1, err2, err3);
        }    

  $('.results-list ul').on('click', '.show-album-list', function(event) {
        searchAlbums($(event.target).parent().text());
      })
      
  function searchAlbums (artist_name) {
        var search_string = artist_name.replace(' ','%20');
        $('.modal-header').text(artist_name)
        $.ajax({
          url: 'https://api.spotify.com/v1/search?type=album&query='+search_string,
          data: '',
          success: showAlbums,
          error: handleError,
          dataType: 'json'
          });
       function showAlbums(results){
        $('.modal-header').text(artist_name)
        var albums = results.albums.items;
         $(".modal-body ul").empty();
        albums.forEach(function (album){
          var html_string ='<li class="list-group-item">'+album.name+ '</li>'
          $('.modal-body ul').append(html_string)
        })
       }
       }
})()
    </script>
  </body>
</html>